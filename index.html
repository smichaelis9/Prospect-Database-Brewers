<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Sheets Analytics Dashboard</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; background: #f4f6f8; color: #333; }
    header { background: #1976d2; color: white; padding: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    header h1 { margin: 0; font-size: 1.8em; }
    header p { margin: 5px 0 0; font-size: 0.9em; opacity: 0.9; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px auto; max-width: 1200px; padding: 0 20px; }
    .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 15px; }
    .card i { font-size: 2em; color: #1976d2; }
    .card h3 { margin: 0; font-size: 1.5em; }
    .card p { margin: 0; color: #666; font-size: 0.9em; }
    main { max-width: 1200px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    table.dataTable thead { background-color: #1976d2; color: white; }
    table.dataTable thead th { padding: 10px; }
    table.dataTable tbody tr:hover { background-color: #f1f7ff; }
    @media (max-width: 768px) { header h1 { font-size: 1.4em; } }
  </style>
</head>
<body>
<header>
  <h1>ðŸ“Š My Google Sheets Dashboard</h1>
  <p id="refresh-time">Loading data...</p>
</header>
<section class="cards">
  <div class="card">
    <i class="fa-solid fa-list"></i>
    <div>
      <h3 id="total-rows">0</h3>
      <p>Total Entries</p>
    </div>
  </div>
  <div class="card">
    <i class="fa-solid fa-star"></i>
    <div>
      <h3 id="average-score">0</h3>
      <p>Average Score</p>
    </div>
  </div>
  <div class="card">
    <i class="fa-solid fa-calendar"></i>
    <div>
      <h3 id="latest-date">-</h3>
      <p>Latest Date</p>
    </div>
  </div>
</section>
<main>
  <table id="data-table" class="display"></table>
</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script>
  const sheetURL = 'https://docs.google.com/spreadsheets/d/13IWvHPIkJjlpgun4ogdCu_5WAcau0I4QCFRtcZX_3dA/pub?output=csv';
  let dataTable;
  function loadData() {
    fetch(sheetURL + '&cacheBuster=' + Date.now())
      .then(res => res.text())
      .then(csv => {
        const rows = csv.trim().split('\n').map(r => r.split(','));
        const headers = rows[0];
        const data = rows.slice(1);
        document.getElementById('total-rows').innerText = data.length;
        const scoreIndex = headers.findIndex(h => h.toLowerCase().includes('score'));
        if (scoreIndex !== -1) {
          const scores = data.map(r => parseFloat(r[scoreIndex]) || 0);
          const avg = scores.reduce((a,b) => a+b, 0) / scores.length;
          document.getElementById('average-score').innerText = avg.toFixed(1);
        }
        const dateIndex = headers.findIndex(h => h.toLowerCase().includes('date'));
        if (dateIndex !== -1) {
          const dates = data.map(r => new Date(r[dateIndex])).filter(d => !isNaN(d));
          if (dates.length > 0) {
            const latest = new Date(Math.max(...dates));
            document.getElementById('latest-date').innerText = latest.toLocaleDateString();
          }
        }
        if (!dataTable) {
          let thead = '<thead><tr>' + headers.map(h => `<th>${h}</th>`).join('') + '</tr></thead>';
          let tbody = '<tbody>' + data.map(row => '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') + '</tr>').join('') + '</tbody>';
          document.getElementById('data-table').innerHTML = thead + tbody;
          dataTable = $('#data-table').DataTable({ pageLength: 10, responsive: true });
        } else {
          dataTable.clear();
          dataTable.rows.add(data);
          dataTable.draw();
        }
        document.getElementById('refresh-time').innerText = 'Last updated: ' + new Date().toLocaleTimeString();
      })
      .catch(err => console.error('Error fetching data:', err));
  }
  loadData();
  setInterval(loadData, 120000);
</script>
</body>
</html>
